---
layout:     post
title:      "Linux下C++编程(二)"
subtitle:   "2017/07/28 vim简单使用"
date:       2017-07-28
author:     "WangXiaoDong"
header-img: "https://github.com/Dongzhixiao/PictureCache/blob/master/diaryPic/20170727.jpg?raw=true"
tags:
    - Linux
    - Vim
---

### 时间:2017年7月28日 天气:晴
-----
#####   Author:冬之晓:angry:
#####   Email: 347916416@qq.com
----------

## Vim使用

### 简介

Vim（Vi[Improved]）编辑器是功能强大的跨平台文本文件编辑工具，继承自Unix系统的Vi编辑器，支持Linux/Mac OS X/Windows系统，
利用它可以建立、修改文本文件。进入Vim编辑程序，可以在终端输入下面的命令：

`vim [filename]`
----filename是要编辑器的文件的路径名。
如果文件不存在，它将为你建立一个新文件。
Vim编辑程序有三种操作模式，分别称为 编辑模式、插入模式 和 命令模式，当运行Vim时，首先进入编辑模式。

#### 编辑模式

Vim编辑方式的主要用途是在被编辑的文件中移动光标的位置。
一旦光标移到到所要的位置，就可以进行剪切和粘贴正文块，删除正文和插入新的正文。
当完成所有的编辑工作后，需要保存编辑器结果，退出编辑程序回到终端，可以发出ZZ命令，连续按两次大写的Z键。

- 跳转

如果键盘上有上、下、左、右箭头的导航键，就由这些键来完成光标的移动。另外，可以用下面的键完成同样的 按字符移动 功能：

- k----上移；
- j----下移；
- h----左移；
- l右移。

上面这４个键将光标位置每次移动一行或一个 字符 。Vim还提供稍大范围移动光标的命令：

- ctrl+f----在文件中前移一页（相当于 page down）；
- ctrl+b----在文件中后移一页（相当于 page up）；

更大范围的移动：

- *----当光标停留在一个单词上，* 键会在文件内搜索该单词，并跳转到下一处；
- #----当光标停留在一个单词上，# 在文件内搜索该单词，并跳转到上一处；
- (/)----移动到 前/后 句 的开始；
- {/}----跳转到 当前/下一个 段落 的开始。
- g_----到本行最后一个不是 blank 字符的位置。
- fa----到下一个为 a 的字符处，你也可以fs到下一个为s的字符。
- t,----到逗号前的第一个字符。逗号可以变成其它字符。
- 3fa----在当前行查找第三个出现的 a。
- F/T----和 f 和 t 一样，只不过是相反方向;
- gg----将光标定位到文件第一行起始位置；
- G----将光标定位到文件最后一行起始位置；
- NG或Ngg----将光标定位到第 N 行的起始位置。

在屏幕中找到需要的 一页 时，可以用下面的命令快速移动光标：

- H----将光标移到屏幕上的起始行（或最上行）；
- M----将光标移到屏幕中间；
- L----将光标移到屏幕最后一行。

同样需要注意字母的大小写。H 和 L 命令还可以加数字。如 2H 表示将光标移到屏幕的第２行，3L 表示将光标移到屏幕的倒数第3行。
当将光标移到所要的行是，行内移动 光标可以用下面的命令来实现：

- w----右移光标到下一个字的开头；
- e----右移光标到一个字的末尾；
- b----左移光标到前一个字的开头；
- 0----数字０，左移光标到本行的开始；
- $----右移光标，到本行的末尾；
- ^----移动光标，到本行的第一个非空字符。

#### 搜索匹配

和许多先进的编辑器一样，Vim 提供了强大的字符串搜索功能。要查找文件中指定字或短语出现的位置，可以用Vim直接进行搜索，而不必以手工方式进行。
搜索方法是：键入字符 / ，后面跟以要搜索的字符串，然后按回车键。编辑程序执行正向搜索（即朝文件末尾方向），并在找到指定字符串后，
将光标停到该字符串的开头；键入 n 命令可以继续执行搜索，找出这一字符串下次出现的位置。用字符 ? 取代 / ，可以实现反向搜索（朝文件开头方向）。
例如：

- /str1----正向搜索字符串 str1；
- n----继续搜索，找出 str1 字符串下次出现的位置；
- N----继续搜索，找出 str1 字符串上一次出现的位置；
- ?str2----反向搜索字符串 str2 。

无论搜索方向如何，当到达文件末尾或开头时，搜索工作会循环到文件的另一端并继续执行。
Vim中执行搜索匹配最强大的地方是结合 正则表达式 来搜索，后续将会介绍。

#### 替换和删除

Vim常规的删除命令是 d、 x (前者删除 行 ，后者删除 字符 ),结合Vim的其他特性可以实现基础的删除功能。
将光标定位于文件内指定位置后，可以用其他字符来替换光标所指向的字符，或从当前光标位置删除一个或多个字符或一行、多行。例如：

- rc----用 c 替换光标所指向的当前字符；
- nrc----用 c 替换光标所指向的前 n 个字符；
- 5rA----用 A 替换光标所指向的前 5 个字符；
- x----删除光标所指向的当前字符；
- nx----删除光标所指向的前 n 个字符；
- 3x----删除光标所指向的前 3 个字符；
- dw----删除光标右侧的字；
- ndw----删除光标右侧的 n 个字；
- 3dw----删除光标右侧的 3 个字；
- db----删除光标左侧的字；
- ndb----删除光标左侧的 n 个字；
- 5db----删除光标左侧的 5 个字；
- dd----删除光标所在行，并去除空隙；
- ndd----删除（剪切） n 行内容，并去除空隙；
- 3dd----删除（剪切） 3 行内容，并去除空隙；

其他常用的删除命令有：

- d$----从当前光标起删除字符直到行的结束；
- d0----从当前光标起删除字符直到行的开始；
- J----删除本行的回车符（CR），并和下一行合并。

Vim常规的替换命令有 c 和 s ，结合Vim的其他特性可以实现基础的替换功能，不过替换命令执行以后，通常会由 编辑模式 进入 插入模式 ：

- s                用输入的正文替换光标所指向的字符；
- S                删除当前行，并进入编辑模式；
- ns               用输入的正文替换光标右侧 n 个字符；
- nS               删除当前行在内的 n 行，并进入编辑模式；
- cw               用输入的正文替换光标右侧的字；
- cW               用输入的正文替换从光标到行尾的所有字符（同 c$ )；
- ncw              用输入的正文替换光标右侧的 n 个字；
- cb               用输入的正文替换光标左侧的字；
- ncb              用输入的正文替换光标左侧的 n 个字；
- cd               用输入的正文替换光标的所在行；
- ncd              用输入的正文替换光标下面的 n 行；
- c$               用输入的正文替换从光标开始到本行末尾的所有字符；
- c0               用输入的正文替换从本行开头到光标的所有字符。

#### 复制粘贴

从正文中删除的内容（如字符、字或行）并没有真正丢失，而是被剪切并复制到了一个内存缓冲区中。
用户可将其粘贴到正文中的指定位置。完成这一操作的命令是：

- p               小写字母 p，将缓冲区的内容粘贴到光标的后面；
- P               大写字母 P，将缓冲区的内容粘贴到光标的前面。

如果缓冲区的内容是字符或字，直接粘贴在光标的前面或后面；
如果缓冲区的内容为整行正文，执行上述粘贴命令将会粘贴在当前光标所在行的上一行或下一行。
注意上述两个命令中字母的大小写。Vim 编辑器经常以一对大、小写字母（如 p 和 P）来提供一对相似的功能。
通常，小写命令在光标的后面进行操作，大写命令在光标的前面进行操作。

有时需要复制一段正文到新位置，同时保留原有位置的内容。这种情况下，首先应当把指定内容复制（而不是剪切）到内存缓冲区。
完成这一操作的命令是：

- yy              复制当前行到内存缓冲区；
- nyy             复制 n 行内容到内存缓冲区；
- 5yy             复制 5 行内容到内存缓冲区；
- “+y             复制 1 行到操作系统的粘贴板；
- “+nyy           复制 n 行到操作系统的粘贴板。

#### 撤销和重复

在编辑文档的过程中，为消除某个错误的编辑命令造成的后果，可以用撤消命令。另外，如果用户希望在新的光标位置重复前面执行过的编辑命令，可用重复命令。

- u               撤消前一条命令的结果；
- .               重复最后一条修改正文的命令。

### 插入模式

#### 进入插入模式

在编辑模式下正确定位光标之后，可用以下命令切换到插入模式：

- i            在光标左侧插入正文
- a            在光标右侧插入正文
- o            在光标所在行的下一行增添新行
- O            在光标所在行的上一行增添新行
- I            在光标所在行的开头插入
- A            在光标所在行的末尾插入

#### 退出插入模式

退出插入模式的方法是，按 ESC 键或组合键 Ctrl+[ ，退出插入模式之后，将会进入编辑模式 。

### 命令模式

在Vim的命令模式下，可以使用复杂的命令。在编辑模式下键入 : ，光标就跳到屏幕最后一行，并在那里显示冒号，此时已进入命令模式。命令模式又称 末行模式 ，用户输入的内容均显示在屏幕的最后一行，按回车键，Vim 执行命令。

#### 打开、保存、退出

在已经启动的Vim中打开一个文件需要用 :e 命令：

:e path_to_file/filename
保存当前编辑的文件需要用 :w 命令（单词 write 的缩写）：

:w
将当前文件另存为 file_temp 则：

:w file_temp
在编辑模式下可以用 ZZ 命令退出Vim编辑程序，该命令保存对正文所作的修改，覆盖原始文件。如果只需要退出编辑程序，而不打算保存编辑的内容，可用下面的命令：

- :q                在未作修改的情况下退出；
- :q!               放弃所有修改，退出编辑程序。
保存并退出则可以讲两条命令结合起来使用（注意命令顺序，先保存，后退出）：

- :wq

####行号与文件

编辑中的每一行正文都有自己的行号，用下列命令可以移动光标到指定行（效果与 编辑模式 下的 ngg 或 nG 相同）：

: n             将光标移到第 n 行
命令模式下，可以规定命令操作的行号范围。数值用来指定绝对行号；字符“.”表示光标所在行的行号；字符符“$”表示正文最后一行的行号；简单的表达式，例如“.+5”表示当前行往下的第 5 行。例如：

:345                  将光标移到第 345 行
:345w file            将第 345 行写入 file 文件
:3,5w file            将第 3 行至第 5 行写入 file 文件
:1,.w file            将第 1 行至当前行写入 file 文件
:.,$w file            将当前行至最后一行写入 file 文件
:.,.+5w file          从当前行开始将 6 行内容写入 file 文件
:1,$w file            将所有内容写入 file 文件，相当于 :w file 命令
在命令模式下，允许从文件中读取正文，或将正文写入文件。例如：

:w                 将编辑的内容写入原始文件，用来保存编辑的中间结果
:wq                将编辑的内容写入原始文件并退出编辑程序（相当于 ZZ 命令）
:w file            将编辑的内容写入 file 文件，保持原有文件的内容不变
:a,bw file         将第 a 行至第 b 行的内容写入 file 文件
:r file            读取 file 文件的内容，插入当前光标所在行的后面
:e file            编辑新文件 file 代替原有内容
:f file            将当前文件重命名为 file
:f                 打印当前文件名称和状态，如文件的行数、光标所在的行号等

#### 字符串搜索

在 编辑模式 讲过字符串的搜索，此处的 命令模式 也可以进行字符串搜索，给出一个字符串，可以通过搜索该字符串到达指定行。如果希望进行正向搜索，将待搜索的字符串置于两个 / 之间；如果希望反向搜索，则将字符串放在两个 ? 之间。例如：

:/str/                  正向搜索，将光标移到下一个包含字符串 str 的行
:?str?                  反向搜索，将光标移到上一个包含字符串 str 的行
:/str/w file            正向搜索，并将第一个包含字符串 str 的行写入 file 文件
:/str1/,/str2/w file    正向搜索，并将包含字符串 str1 的行至包含字符串 str2 的行写

#### Vim中的正则表达式

当给Vim指定搜索字符串时，可以包含具有特殊含义的字符。包含这些特殊字符的搜索字符串称为正则表达式（Regular Expressions）。例如，要搜索一行正文，这行正文的开头包含 struct 字。下面的命令做不到这一点：

:/struct/
因为它只找出在行中任意位置包含 struct的第一行，并不一定在行的开始包含 struct 。解决问题的办法是在搜索字符串前面加上特殊字符^：

:/^struct/
^ 字符比较每行开头的字符串。所以上面的命令表示：找出以字符串 struct 开头的行。
也可以用类似办法在搜索字符串后面加上表示行的末尾的特殊字符 $ 来找出位于行末尾的字：

:/^struct/
下表给出大多数特殊字符和它们的含义：

^                放在字符串前面，匹配行首的字；
$                放在字符串后面，匹配行尾的字；
\<               匹配一个字的字头；
\>               匹配一个字的字尾；
.                匹配任何单个正文字符；
[str]            匹配 str 中的任何单个字符；
[^str]           匹配任何不在 str 中的单个字符；
[a-b]            匹配 a 到 b 之间的任一字符；
*                匹配前一个字符的 0 次或多次出现；
\                转义后面的字符。

#### 正文替换

利用 :s 命令可以实现字符串的替换。具体的用法包括：

:%s/str1/str2/        用字符串 str2 替换行中首次出现的字符串 str1
:s/str1/str2/g        用字符串 str2 替换行中所有出现的字符串 str1
:.,$ s/str1/str2/g    用字符串 str2 替换正文当前行到末尾所有出现的字符串 str1
:1,$ s/str1/str2/g    用字符串 str2 替换正文中所有出现的字符串 str1
:g/str1/s//str2/g     功能同上
:m,ns/str1/str2/g     将从m行到n行的str1替换成str2
从上述替换命令可以看到：

g 放在命令末尾，表示对搜索字符串的每次出现进行替换,不止匹配每行中的第一次出现；不加 g，表示只对搜索字符串的首次出现进行替换；g 放在命令开头，表示对正文中所有包含搜索字符串的行进行替换操作;
s 表示后面跟着一串替换的命令；
% 表示替换范围是所有行，即全文。
另外一个实用的命令，在Vim中统计当前文件中字符串 str1 出现的次数，可用替换命令的变形：

:%s/str1/&/gn

#### 删除正文

在命令模式下，同样可以删除正文中的内容。例如：

:d                              删除光标所在行
:3d                             删除 3 行
:.,$d                           删除当前行至正文的末尾
:/str1/,/str2/d                 删除从字符串 str1 到 str2 的所有行
:g/^\(.*\)$\n\1$/d              删除连续相同的行，保留最后一行
:g/\%(^\1$\n\)\@<=\(.*\)$/d     删除连续相同的行，保留最开始一行
:g/^\s*$\n\s*$/d                删除连续多个空行，只保留一行空行
:5,20s/^#//g                    删除5到20行开头的 # 注释
总之，Vim的初级删除命令是用 d ，高级删除命令可以用 正则替换 的方式执行。

#### 恢复文件

Vim 在编辑某个文件时，会另外生成一个临时文件，这个文件的名称通常以 . 开头，并以 .swp 结尾。
Vim 在正常退出时，该文件被删除，若意外退出，而没有保存文件的最新修改内容，则可以使用恢复命令 :recover 来恢复文件，也可以在启动Vim时用 -r 选项。

#### 选项设置

为控制不同的编辑功能，Vim 提供了很多内部选项。利用 :set 命令可以设置选项。基本语法为：

:set option         设置选项 option
常见的功能选项包括：

autoindent        设置该选项，则正文自动缩进
ignorecase        设置该选项，则忽略规则表达式中大小写字母的区别
number            设置该选项，则显示正文行号
ruler             设置该选项，则在屏幕底部显示光标所在行、列的位置
tabstop           设置按 Tab 键跳过的空格数。例如 :set tabstop=n，n 默认值为 8
mk                将选项保存在当前目录的 .exrc 文件中

#### Shell切换

当处于编辑的对话过程中时，可能需要执行一些Linux命令。如果需要保存当前的结果，退出编辑程序，再执行所需的Linux命令，然后再回头继续编辑过程，就显得十分累赘。如果能在编辑的环境中运行Linux命令就要省事得多。在Vim中，可以用下面的命令来做到这一点：

:!shell_command   执行完 shell_command 后回到Vim
这称为Shell切换。它允许执行任何可以在标准的Shell提示符下执行的命令。当这条命令执行完毕，控制返回给编辑程序。又可以继续编辑对话过程。

#### 分屏与标签页

分屏

普通的Vim模式，打开一个Vim程序只能查看一个文件，如果想同时查看多个文件，就需要用到Vim分屏与标签页功能。
Vim的分屏，主要有两种方式：上下分屏（水平分屏）和左右分屏（垂直分屏），在命令模式分别敲入以下命令即可：

:split（可用缩写 :sp）            上下分屏；
:vsplit（可用缩写 :vsp）          左右分屏。
另外，也可以在终端里启动vim时就开启分屏操作：

vim -On file1 file2...   打开 file1 和 file2 ，垂直分屏
vim -on file1 file2...   打开 file1 和 file2 ，水平分屏
理论上，一个Vim窗口，可以分为多个Vim屏幕，切换屏幕需要用键盘快捷键，命令分别有：

Ctrl+w+h            切换到当前分屏的左边一屏；
Ctrl+w+l            切换到当前分屏的右边一屏；
Ctrl+w+j            切换到当前分屏的下方一屏；
Ctrl+w+k            切换到当前分屏的上方一屏。
即键盘上的h,j,k,l 四个Vim专用方向键，配合Ctrl键和w键（window的缩写），就能跳转到目标分屏。另外，也可以直接按 Ctrl+w+w 来跳转分屏，不过跳转方向则是在当前Vim窗口所有分屏中，按照逆时针方向跳转。
下面是改变尺寸的一些操作，主要是高度，对于宽度你可以使用 [Ctrl+W <] 或是 [Ctrl+W >] ，但这可能需要最新的版本才支持。

Ctrl+W =            让所有的屏都有一样的高度；
Ctrl+W +            增加高度；
Ctrl+W -            减少高度。

## 查看后台任务(jobs)

为了做例子，首先新建几个后台任务(在任务后面加&代表后台执行该任务)
然后执行jobs命令

```
sleep 1000 &
sleep 1500 &
sleep 2000 &
sleep 2500 &
sleep 3000 &
jobs
```

显示：

```
[1]+ Running  sleep 1000 &
[2]  Running  sleep 1500 &
[3]  Running  sleep 2000 &
[3]  Running  sleep 2500 &
[3]- Running  sleep 3000 &
```

其中[num]代表任务编号 +号代表优先级高的任务，-号代表优先级低的任务

## 将后台任务调度到前台执行(fg)

### 不带参执行
数默认将使用+号的任务调度到前台，比如，接着上面的例子：
使用`fg`会使得sleep 1000任务在前台执行，显示：
`sleep 1000`
然后为了使用其他命令，可以先输入'ctrl+z'将前台任务`sleep 1000`挂起

### 指定对应编号任务调度到前台
使用`fg 任务编号`将指定编号任务调度到前台
``

## 将挂起的后台任务重新运行起来(bg)

### 不带参数
默认将带+号的挂起任务重新运行起来

### 指定对应编号任务重新运行起来

## 终止某个进程(kill)

### 直接加上需要终止的进程PID号即可

### 直接加上%num终止jobs命令产生的编号数num的进程

## find 
也用于查找文件，但更为强大，支持正则，并且可将查找结果传递到其他命令。

`find . -name PATTERN`----从当前目录查找符合 PATTERN 的文件
模式需要加上引号：
find . -name "f*";

`find /home -name PATTERN -exec ls -l {} \;`
----从 /home 文件查找所有符合 PATTERN 的文件，并交由 ls 输出详细信息 

>注意，分号(;)是-exec命令的结束符号，必须加，同时该分号不表示分割命令
因此需要加上\转意！

# 显示目前登入系统的用户信息的命令(who)

执行这项指令可得知目前有那些用户登入系统，单独执行who指令会列出登入帐号，使用的 
终端机，登入时间以及从何处登入或正在使用哪个显示器。 
参数： 
-H或--heading----显示各栏位的标题信息列。 
-i或-u或--idle----显示闲置时间，若该用户在前一分钟之内有进行任何动作，将标示成"."号，如果该用户已超过24小时没有任何动作，则标示出"old"字符串。 
-m----此参数的效果和指定"am i"字符串相同。 
-q或--count----只显示登入系统的帐号名称和总人数。

输入`who am i`显示自己的登录信息

## 磁盘使用情况命令(du)
磁盘使用(disk usage)的命令，显示出来
参数-k表示以k为单位
参数-h

## 检查linux服务器的文件系统的磁盘空间占用情况(df)
显示指定磁盘文件的可用空间。如果没有文件名被指定，则所有当前被挂载的文件系统的可用空间将被显示。
默认情况下，磁盘空间将以 1KB 为单位进行显示，除非环境变量 POSIXLY_CORRECT 被指定，那样将以512字节为单位进行显示

## 环境命令(env)
打印出所有环境变量的内容

一些环境变量有特殊用途，比如：

### PS1环境变量
PS1这个环境变量的值代表命令提示符显示的样子
PS1里头都能配置些命令提示符的参数：

- \d----代表日期，格式为weekday month date，例如："Mon Aug 1"
- \H----完整的主机名称。例如：我的机器名称为：fc4.linux，则这个名称就是fc4.linux
- \h----仅取主机的第一个名字，如上例，则为fc4，.linux则被省略
- \t----显示时间为24小时格式，如：HH：MM：SS
- \T----显示时间为12小时格式
- \A----显示时间为24小时格式：HH：MM
- \u----当前用户的账号名称
- \v----BASH的版本信息
- \w----完整的工作目录名称。家目录会以 ~代替
- \W----利用basename取得工作目录名称，所以只会列出最后一个目录
- \#----下达的第几个命令- 
- \$----提示字符，如果是root时，提示符为：# ，普通用户则为：$

可以修改PS1的值：`PS1="[\u@\h \w]$"`

### PATH环境变量

为shell指令查找可执行文件的目录
比如想让shell指令可以在当前目录下找可执行文件可以输入：
`PATH="$PATH:."`
但是这修改仅仅在当前控制台有用，所以如果想要一只有效，需要将设置放在
初始化文件里，初始化文件在`~/.bashrc`
修改后每次新开终端都会生效，或者在当前终端执行：
`source ~/.bashrc`命令即可即时生效

## 寻找使用命令的地址(which)

`which cal`----输出：`/usr/bin/cal`

## 寻找同一个命令可在哪里出现(whereis)

`which cal`----输出：`/usr/bin/cal /usr/bin/X11cal /usr/share/man/man1/cal.1.gz`
