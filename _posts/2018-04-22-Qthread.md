---
layout:     post
title:      "周末的休息"
subtitle:   "2018/04/22 Qthread"
date:       2018-04-22
author:     "WangXiaoDong"
header-img: "https://github.com/Dongzhixiao/PictureCache/blob/master/diaryPic/20180422.jpg?raw=true"
tags:
    - 日记
---



```
    今天是周日，经过昨天一夜的大雨，早晨的天气真的非常清爽！今天准备思考一下论文对环境实际的意义，然后顺便
继续总结上周使用pyqt编程的经验。这样以后遇到同样的问题就能很快回忆起来啦~
```


今天准备总结一下pyqt编写界面的经验，这样以后遇到同样问题就可以查看并且很快回忆起来！

## 环境搭建
经过一周的研究，我发现使用pyqt编写界面最快的方式还是eric + pycharm

## 主界面绘制经验



使用`eric6`和`pycharm`

## 信号和槽的使用经验

如果想要在`python`中使用信号和槽函数，需要继承`QObjcet`，然后使用语法

## 主界面和次级界面编程经验

我实际编写界面程序时的原则是：如果不需要次级窗口，就尽量不用，因为没多一个次级窗口，就代表要多两个`.py`文件。
但是当界面逻辑很多时，如果不用次级窗口，就会导致主窗口的槽函数非常多，看起来不方便。所以到底是否需要用次级窗口。
还是要根据你自己的习惯选择比较好。这里仅仅介绍如何实现次级窗口

### Qt内置次级窗口

### 自定义对话框窗口

这里一定要使用`QDialog`，因为我发现使用`QWidget` 就没有关闭按钮，不知道为啥。但是`Qdialog`继续`Qwidget`，因此
使用它肯定能完成`Qwidget`的任务。

前两部跟编写主界面没区别，在`Forms`区域新建`Qdialog`，命名，然后打开`QtDesign`，绘制自己需要的控件，然后


## 主线程和次线程编程经验

在计算复杂任务的时候，为了保证主界面不失去响应，就必须要使用多线程编程。通常情况下，需要让主线程的界面上出现一些
进度条或者状态栏提示，让客户可以观察到复杂任务执行进度，这样才能让客户知道程序仍然在正常运行和执行的进度，决定是否
继续运行该复杂任务。

自己实现线程，需要继承`PyQt5.QtCore.QThread`类(一开始我继承(QObjcet,Thread.threading)，发现有问题，最后想到还不如直接继承
Qt自带的线程类)。

这样可以自定义信号，因为主线程和次线程的通信要使用信号和槽函数，因为`Qt`的信号好槽是可以跨线程的，而子线程不能用于直接刷新界面。
如果直接自己定义信号和槽函数，按照上次将的方式即可，这里创建的线程直接的通信只涉及基本数据结构，这样就不用在Qt中注册元信息了。

>思考一下，如果直接主线程逻辑中新建定义一个线程，这样无法完成通信操作

对于复杂到数据结构的通信，我就只让子线程执行完毕后，将结果通过线程的一个函数`getResult`返回即可。

详细代码如下：

```
from PyQt5.QtCore import pyqtSignal,QThread

class theThread(QThread):
    def __init__(self):
        super(theThread, self).__init__()

    def setFun(self,fun):
        self.func = fun

    def setArgs(self,args):
        self.args = args
        self.FileDirStr = args[3]

    def getResult(self):
        return self.res

    def run(self):
        print('starting thread', self.name)
        self.res = self.func(self,self.args[0], self.args[1], self.args[2])
        print('finished thread', self.name)

    progress_changed = pyqtSignal(int, name='progressChanged')
    textBrower_changed = pyqtSignal(str, name='textBrowerChanged')
    status_changed = pyqtSignal(str, name='statusChanged')
```

这样可以看出，在run函数中调用了该线程在设置`setFun`时的函数。可以看出，线程调用的需要复杂计算量的函数，最好使用
`**kw`关键字参数。因为在设置参数`setArgs`函数时必须确定传入的参数的数目，用一个关键字参数就可以解决很多问题。
同时函数中需要传入线程本身`self`的参数，需要更新界面状态就通过线程本身发射信号，这样主线程中开始该线程时要连接
对应信号即可







